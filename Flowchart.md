# Smart Donation FoodBox – Διάγραμμα Ροής

Το παρακάτω διάγραμμα ροής περιγράφει τη βασική λειτουργία του **Smart Donation FoodBox (QR-Controlled Community Food Locker)**, από την εκκίνηση του συστήματος έως την πρόσβαση με QR, τον έλεγχο ασφάλειας και την καταγραφή συμβάντων.

---

```mermaid
flowchart TD
  %% =========================
  %% Smart Donation FoodBox
  %% QR-Controlled Community Food Locker
  %% =========================

  A([ΕΚΚΙΝΗΣΗ / Τροφοδοσία]) --> B[Αρχικοποίηση συστήματος\n(MCU, QR Scanner, DHT, LEDs, Buzzer, Reed Switches)]
  B --> C[Κλείδωμα ΟΛΩΝ των compartments]
  C --> D{Διαθέσιμο Wi-Fi;\n(ESP32 – προαιρετικό)}
  D -- ΝΑΙ --> E[Σύνδεση & συγχρονισμός\n(online καταγραφή)]
  D -- ΟΧΙ --> F[Offline λειτουργία\n(τοπική καταγραφή)]
  E --> G[ΑΝΑΜΟΝΗ / READY\nLED: ΠΡΑΣΙΝΟ]
  F --> G

  %% --- Συνεχής έλεγχος ασφάλειας ---
  G --> H[Περιοδικός έλεγχος\nΘερμοκρασίας / Υγρασίας (DHT)]
  H --> I{Τιμές εκτός ορίων\nγια > Χ δευτ.;}
  I -- ΝΑΙ --> J[ΣΥΝΑΓΕΡΜΟΣ\nLED: ΚΟΚΚΙΝΟ + Buzzer\nΚαταγραφή TEMP_ALERT]
  J --> G
  I -- ΟΧΙ --> K[Αναμονή ενέργειας\n(QR scan ή παραβίαση)]
  K --> L{Σαρώθηκε QR code;}

  %% --- Έλεγχος QR ---
  L -- ΝΑΙ --> M[Ανάλυση QR token\n(δωρητής / ωφελούμενος)]
  M --> N{Έγκυρο QR;\n(λήξη / δικαίωμα)}
  N -- ΟΧΙ --> O[ΑΠΟΡΡΙΨΗ\nLED: ΚΟΚΚΙΝΟ (αναβόσβημα)\nΚαταγραφή QR_FAIL]
  O --> G

  N -- ΝΑΙ --> P[Επιλογή διαθέσιμου compartment]
  P --> Q{Υπάρχει διαθέσιμο;}
  Q -- ΟΧΙ --> R[ΜΗ ΔΙΑΘΕΣΙΜΟ\nLED: ΚΙΤΡΙΝΟ\nΚαταγραφή NO_AVAILABLE]
  R --> G

  Q -- ΝΑΙ --> S[Έλεγχος κατάστασης compartment\n(πόρτα κλειστή & ασφαλής)]
  S --> T{Κατάσταση ΟΚ;}
  T -- ΟΧΙ --> U[Παράλειψη compartment\nΚαταγραφή COMPARTMENT_UNSAFE]
  U --> P

  T -- ΝΑΙ --> V[ΞΕΚΛΕΙΔΩΜΑ πόρτας\n(servo / solenoid)\nLED: ΜΠΛΕ]
  V --> W[Χρονόμετρο ανοίγματος\n(π.χ. 20–30 δευτ.)]
  W --> X{Έκλεισε η πόρτα\n(reed switch);}

  X -- ΝΑΙ --> Y[ΚΛΕΙΔΩΜΑ πόρτας\nLED: ΠΡΑΣΙΝΟ]
  Y --> Z[Καταγραφή συμβάντος\nQR_OK + OPEN + CLOSE]
  Z --> G

  X -- ΟΧΙ --> AA{Έληξε ο χρόνος;}
  AA -- ΟΧΙ --> X
  AA -- ΝΑΙ --> AB[ΠΟΡΤΑ ΑΝΟΙΧΤΗ ΠΟΛΥ\nBuzzer + LED: ΚΟΚΚΙΝΟ\nΚαταγραφή TIMEOUT]
  AB --> AC{Έκλεισε τελικά;}
  AC -- ΝΑΙ --> Y
  AC -- ΟΧΙ --> AD[ΚΛΙΜΑΚΩΣΗ\nΣυνεχής συναγερμός\nΑπαιτείται reset]
  AD --> G

  %% --- Ανίχνευση παραβίασης ---
  L -- ΟΧΙ --> AE{Άνοιγμα πόρτας\nχωρίς QR;}
  AE -- ΟΧΙ --> G
  AE -- ΝΑΙ --> AF[ΠΑΡΑΒΙΑΣΗ\nLED: ΚΟΚΚΙΝΟ + Buzzer\nΚαταγραφή TAMPER]
  AF --> AG[Κλείδωμα όλων & ειδοποίηση διαχειριστή]
  AG --> G
